# Paramètres d'optimisation walk-forward
optimization:
  is_window_days: 120     # In-sample : 4 mois
  oos_window_days: 30     # Out-of-sample : 1 mois
  step_days: 30           # Pas glissant entre fenêtres
  metric: "sharpe_ratio"  # Métrique d'optimisation (sharpe_ratio | net_return_pct | profit_factor)
  max_workers: 4           # Séquentiel uniquement (pool instable sur laptop i9-14900HX)
  validation_exchange: "bitget"  # Exchange pour la validation croisée

vwap_rsi:
  default:
    timeframe: ["5m", "15m"]
    rsi_period: [10, 14, 20]
    rsi_long_threshold: [25, 30, 35]
    rsi_short_threshold: [65, 70, 75]
    volume_spike_multiplier: [1.5, 2.0, 2.5]
    vwap_deviation_entry: [0.1, 0.2, 0.3, 0.5]
    trend_adx_threshold: [20, 25, 30]
    tp_percent: [0.4, 0.6, 0.8, 1.0]
    sl_percent: [0.2, 0.3, 0.4, 0.5]
  BTC/USDT:
    sl_percent: [0.2, 0.3, 0.4]
    tp_percent: [0.4, 0.6, 0.8]
  SOL/USDT:
    sl_percent: [0.4, 0.5, 0.7]
    tp_percent: [0.6, 0.8, 1.0, 1.2]

momentum:
  default:
    timeframe: ["5m", "15m"]
    breakout_lookback: [15, 20, 30, 40]
    volume_confirmation_multiplier: [1.5, 2.0, 2.5]
    atr_multiplier_tp: [1.5, 2.0, 2.5]
    atr_multiplier_sl: [0.5, 1.0, 1.5]
    tp_percent: [0.4, 0.6, 0.8, 1.0]
    sl_percent: [0.2, 0.3, 0.5]

# Funding : ~192 combos (4×4×4×3 = 192)
# extreme_negative_threshold miroir automatique de extreme_positive_threshold
funding:
  default:
    timeframe: ["5m", "15m"]
    extreme_positive_threshold: [0.01, 0.02, 0.03, 0.05]
    entry_delay_minutes: [0, 3, 5, 10]
    tp_percent: [0.2, 0.3, 0.4, 0.6]
    sl_percent: [0.1, 0.2, 0.3]

# Liquidation : ~576 combos (4×4×4×3×4 = 768, réduit par coarse sampling)
liquidation:
  default:
    timeframe: ["5m", "15m"]
    oi_change_threshold: [3.0, 5.0, 7.0, 10.0]
    leverage_estimate: [10, 15, 20, 25]
    zone_buffer_percent: [0.5, 1.0, 1.5, 2.0]
    tp_percent: [0.4, 0.6, 0.8]
    sl_percent: [0.2, 0.3, 0.4, 0.5]

# --- Stratégies 1h ---

bollinger_mr:
  wfo:
    is_days: 180
    oos_days: 60
    step_days: 60
  default:
    timeframe: ["1h", "4h"]
    bb_period: [15, 20, 25, 30]
    bb_std: [1.5, 2.0, 2.5]
    sl_percent: [3.0, 5.0, 7.0, 10.0]

donchian_breakout:
  wfo:
    is_days: 180
    oos_days: 60
    step_days: 60
  default:
    timeframe: ["1h", "4h"]
    entry_lookback: [20, 30, 40, 55]
    atr_period: [10, 14, 20]
    atr_tp_multiple: [2.0, 3.0, 4.0]
    atr_sl_multiple: [1.0, 1.5, 2.0]

supertrend:
  wfo:
    is_days: 180
    oos_days: 60
    step_days: 60
  default:
    timeframe: ["1h", "4h"]
    atr_period: [7, 10, 14, 20]
    atr_multiplier: [2.0, 2.5, 3.0, 4.0]
    tp_percent: [3.0, 4.0, 6.0, 8.0]
    sl_percent: [1.5, 2.0, 3.0, 4.0]

# Bollinger Trend : 486 combos (3×3×3×3×3×2)
boltrend:
  wfo:
    is_days: 180
    oos_days: 60
    step_days: 60
  default:
    bol_window: [50, 100, 150]
    bol_std: [1.5, 2.0, 2.5]
    long_ma_window: [200, 400, 550]
    sl_percent: [10.0, 15.0, 20.0]
    min_bol_spread: [0.0, 0.01, 0.02]
    timeframe: ["1h", "4h"]

# Grid BolTrend : 1296 combos (2×3×2×2×2×3×3×3)
grid_boltrend:
  wfo:
    is_days: 180
    oos_days: 60
    step_days: 60
    embargo_days: 7
  default:
    bol_window: [50, 100]
    bol_std: [1.5, 2.0, 2.5]
    long_ma_window: [200, 400]
    min_bol_spread: [0.0, 0.01]
    atr_period: [10, 14]
    num_levels: [2, 3, 4]
    sl_percent: [10.0, 15.0, 20.0]
    atr_spacing_mult: [0.5, 1.0, 1.5]
    timeframe: ["1h"]

# Envelope DCA : 972 combos (3×4×3×5×3×4), coarse LHS 200
envelope_dca:
  wfo:
    is_days: 180
    oos_days: 60
    step_days: 60
  default:
    timeframe: ["1h", "4h", "1d"]
    ma_period: [5, 7, 8, 10]
    num_levels: [2, 3, 4]
    envelope_start: [0.05, 0.07, 0.10, 0.12, 0.15]
    envelope_step: [0.02, 0.03, 0.05]
    sl_percent: [15.0, 20.0, 25.0, 30.0]

# Envelope DCA SHORT : même grille que LONG, à ajuster après WFO
envelope_dca_short:
  wfo:
    is_days: 180
    oos_days: 60
    step_days: 60
  default:
    timeframe: ["1h", "4h", "1d"]
    ma_period: [5, 7, 10]
    num_levels: [2, 3, 4]
    envelope_start: [0.05, 0.07, 0.10]
    envelope_step: [0.02, 0.03, 0.05]
    sl_percent: [15.0, 20.0, 25.0, 30.0]

# Grid ATR v2 : 1728 combos/tf (3×2×3×3×2×2×2×2 ×2 sides), ~30 min/asset
grid_atr:
  wfo:
    is_days: 180
    oos_days: 60
    step_days: 60
    embargo_days: 7
  default:
    timeframe: ["1h"]
    ma_period: [7, 10, 14]
    atr_period: [10, 14]
    atr_multiplier_start: [2.0, 2.5, 3.0]
    atr_multiplier_step: [0.5, 1.0, 1.5]
    num_levels: [3, 4]
    sl_percent: [15.0, 20.0]
    min_grid_spacing_pct: [1.2, 1.8]
    min_profit_pct: [0.0, 0.4]

# Grid Range ATR : 2160 combos (4×3×5×2×3×3×2)
grid_range_atr:
  wfo:
    is_days: 180
    oos_days: 60
    step_days: 60
    embargo_days: 7
  default:
    timeframe: ["1h"]
    ma_period: [14, 20, 50]
    atr_period: [10, 14, 20]
    atr_spacing_mult: [0.3, 0.5, 0.7]
    num_levels: [2, 3]
    sl_percent: [8.0, 12.0, 18.0]
    sides: [["long", "short"], ["long"]]
    tp_mode: ["dynamic_sma", "fixed_center"]

# Grid Multi-TF : 768 combos (2×2×3×2×2×2×2×3×2), ~4 min/asset
grid_multi_tf:
  wfo:
    is_days: 180
    oos_days: 60
    step_days: 60
    embargo_days: 7  # Tampon IS→OOS pour éviter contamination des positions en cours
  default:
    st_atr_period: [10, 14]
    st_atr_multiplier: [2.0, 3.0]
    ma_period: [7, 10, 14]
    atr_period: [10, 14]
    atr_multiplier_start: [1.5, 2.0]
    atr_multiplier_step: [0.5, 1.0]
    num_levels: [2, 3]
    sl_percent: [15.0, 20.0, 25.0]
    min_grid_spacing_pct: [0.0, 0.8]

# Grid Funding : 2592 combos (4×3×2×3×4×3×3), ~8 min/asset
grid_funding:
  wfo:
    is_days: 360
    oos_days: 90
    step_days: 90
  default:
    timeframe: ["1h", "4h"]
    funding_threshold_start: [0.0003, 0.0005, 0.0008, 0.001]
    funding_threshold_step: [0.0003, 0.0005, 0.001]
    num_levels: [2, 3]
    ma_period: [7, 14, 21]
    sl_percent: [10.0, 15.0, 20.0, 25.0]
    tp_mode: ["funding_positive", "sma_cross", "funding_or_sma"]
    min_hold_candles: [4, 8, 16]

# Grid Momentum : ~41472 combos (2×4×4×3×2×3×2×3×3×2×2), ~120 min/asset
grid_momentum:
  wfo:
    is_days: 180
    oos_days: 60
    step_days: 60
  default:
    timeframe: ["1h", "4h"]
    donchian_period: [20, 30, 48, 72]
    vol_multiplier: [1.2, 1.5, 2.0, 2.5]
    atr_period: [10, 14, 20]
    adx_threshold: [0, 20]
    pullback_start: [0.5, 1.0, 1.5]
    pullback_step: [0.5, 1.0]
    num_levels: [2, 3, 4]
    trailing_atr_mult: [2.0, 3.0, 4.0]
    sl_percent: [15, 20]
    cooldown_candles: [0, 3]

# Grid Trend : 7776 combos (3×3×2×1×3×1×3×2×2×4×3), ~24 min/asset
grid_trend:
  wfo:
    is_days: 360
    oos_days: 90
    step_days: 90
  default:
    timeframe: ["1h", "4h", "1d"]
    ema_fast: [20, 30, 40]
    ema_slow: [50, 100]
    adx_period: [14]
    adx_threshold: [15, 20, 25]
    atr_period: [14]
    pull_start: [0.5, 1.0, 1.5]
    pull_step: [0.5, 1.0]
    num_levels: [2, 3]
    trail_mult: [1.5, 2.0, 2.5, 3.0]
    sl_percent: [10, 15, 20]

# ─── Trend Follow Daily ──────────────────────────────────────────────────
# Donchian breakout mode — 432 combos (3×2×2×3×2×1×3×1×2)
trend_follow_daily:
  wfo:
    is_days: 365
    oos_days: 120
    step_days: 60
    embargo_days: 1
  default:
    timeframe: ["1d"]
    entry_mode: ["donchian"]
    donchian_entry_period: [20, 50, 100]
    donchian_exit_period: [10, 20]
    adx_period: [14]
    adx_threshold: [0, 20]
    atr_period: [14]
    trailing_atr_mult: [3.0, 4.0, 5.0]
    exit_mode: ["trailing", "channel"]
    sl_percent: [10.0]
    position_fraction: [0.2, 0.3, 0.5]
    cooldown_candles: [3]
    sides: [["long"], ["long", "short"]]
